# PSR-15 middleware dispatcher

`codeinc/middleware-dispatcher` is a [PSR-15](https://www.php-fig.org/psr/psr-15/) middleware dispatcher. The middleware dispatcher behaves as a PSR-15 [`RequestHandlerInterface`](https://www.php-fig.org/psr/psr-15/#21-psrhttpserverrequesthandlerinterface). It comes in two forms, an abstract class [`AbstractDispatcher`](src/AbstractDispatcher.php) to be extended and a final class [`Dispatcher`](src/Dispatcher.php).

If no response is generated by the middleware, the dispatcher returns a [`NoResponseAvailable`](src/NoResponseAvailable.php) PSR-7 response.

## Usage

Usage of the dispatcher behaving as a PSR-15 request handler:
```php
<?php
use CodeInc\MiddlewareDispatcher\Dispatcher;

// instantiating the dispatcher
$dispatcher = new Dispatcher([
    new MyFirstMiddleware(),
    new MySecondMiddleware()
]);
$dispatcher->addMiddleware(new MyThirdMiddleware());

// handling the request 
// will return a NoResponseAvailable object if the request can not be processed by the middleware
// --> $psr7ServerRequest must be an object implementing ServerRequestInterface
$psr7Response = $dispatcher->handle($psr7ServerRequest); 
```

An alternative dispatcher called [`IteratorDispatcher`](src/IteratorDispatcher.php) allows to use an iterator as source for the dispatcher. Below is an example using a [generator](http://php.net/manual/en/language.generators.overview.php). In this example, the middleware objects are instantiated on the fly. This avoids instantiating unsued middleware objects. If the first middleware is capable of generating a valid response, the next ones will never be instantiated.

```php
<?php
use CodeInc\MiddlewareDispatcher\IteratorDispatcher;

function getMiddleware():Generator 
{
    yield new MyFirstMiddleware();
    yield new MySecondMiddleware();
    yield new MyThirdMiddleware();
}

$dispatcher = new IteratorDispatcher(getMiddleware());
$psr7Response = $dispatcher->handle($psr7ServerRequest); 
```


## Installation

This library is available through [Packagist](https://packagist.org/packages/codeinc/middleware-dispatcher) and can be installed using [Composer](https://getcomposer.org/): 

```bash
composer require codeinc/middleware-dispatcher
```


## License 
This library is published under the MIT license (see the [`LICENSE`](LICENSE) file).